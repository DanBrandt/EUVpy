

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EUVpy.NEUVAC.neuvac &mdash; EUVpy 1 documentation</title>
<<<<<<< HEAD
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
=======
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=29a6c3e3"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            EUVpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../EUVpy.html">EUVpy package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../EUVpy.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../EUVpy.NEUVAC.html">EUVpy.NEUVAC package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../EUVpy.NEUVAC.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../EUVpy.data.html">EUVpy.data package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../EUVpy.empiricalModels.html">EUVpy.empiricalModels package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../EUVpy.empiricalModels.html#subpackages">Subpackages</a></li>
</ul>
</li>
<<<<<<< HEAD
=======
<li class="toctree-l3"><a class="reference internal" href="../../../EUVpy.experiments.html">EUVpy.experiments package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../EUVpy.experiments.html#submodules">Submodules</a></li>
</ul>
</li>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
<li class="toctree-l3"><a class="reference internal" href="../../../EUVpy.tools.html">EUVpy.tools package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../EUVpy.tools.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../EUVpy.tools.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">EUVpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">EUVpy.NEUVAC.neuvac</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for EUVpy.NEUVAC.neuvac</h1><div class="highlight"><pre>
<span></span><span class="c1"># Empirical Model of Solar Irradiance</span>

<span class="c1"># Developed by:</span>
<span class="c1"># Aaron J. Ridley, Ph.D.</span>
<span class="c1"># Daniel A. Brandt, Ph.D.</span>

<span class="c1">#-----------------------------------------------------------------------------------------------------------------------</span>
<span class="c1"># Top-level imports:</span>
<<<<<<< HEAD
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span><span class="p">,</span> <span class="n">minimize</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
=======
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span><span class="p">,</span> <span class="n">minimize</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.cm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">os.path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
<span class="c1">#-----------------------------------------------------------------------------------------------------------------------</span>

<span class="c1">#-----------------------------------------------------------------------------------------------------------------------</span>
<span class="c1"># Local imports:</span>
<<<<<<< HEAD
<span class="kn">from</span> <span class="nn">EUVpy</span> <span class="kn">import</span> <span class="n">tools</span>
=======
<span class="kn">from</span><span class="w"> </span><span class="nn">EUVpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">tools</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
<span class="c1">#-----------------------------------------------------------------------------------------------------------------------</span>

<span class="c1">#-----------------------------------------------------------------------------------------------------------------------</span>
<span class="c1"># Directory management:</span>
<span class="n">here</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
<span class="n">install_dir</span> <span class="o">=</span> <span class="n">here</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
<span class="c1">#-----------------------------------------------------------------------------------------------------------------------</span>

<span class="c1">#-----------------------------------------------------------------------------------------------------------------------</span>
<span class="c1"># Waves Table (coefficients for the old NEUVAC Model):</span>
<span class="c1"># Format: 0-Min, 1-Max, 2-S_1i, 3-S_Ai, 4-S_Di, 5-I_i, 6-Pi, 7-Ai</span>
<span class="n">waveTable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">1700.00</span><span class="p">,</span> <span class="mf">1750.00</span><span class="p">,</span> <span class="mf">1.31491e-06</span><span class="p">,</span> <span class="mf">6.71054e-06</span><span class="p">,</span> <span class="mf">5.78034e-07</span><span class="p">,</span> <span class="mf">0.00355128</span><span class="p">,</span> <span class="mf">1.05517</span><span class="p">,</span> <span class="mf">0.901612</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1650.00</span><span class="p">,</span> <span class="mf">1700.00</span><span class="p">,</span> <span class="mf">5.19285e-07</span><span class="p">,</span> <span class="mf">2.62376e-06</span><span class="p">,</span> <span class="mf">3.08447e-07</span><span class="p">,</span> <span class="mf">0.00218156</span><span class="p">,</span> <span class="mf">1.06245</span><span class="p">,</span> <span class="mf">0.964892</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1600.00</span><span class="p">,</span> <span class="mf">1650.00</span><span class="p">,</span> <span class="mf">3.85348e-07</span><span class="p">,</span> <span class="mf">1.73851e-06</span><span class="p">,</span> <span class="mf">3.34911e-07</span><span class="p">,</span> <span class="mf">0.00115310</span><span class="p">,</span> <span class="mf">1.07246</span><span class="p">,</span> <span class="mf">0.959562</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1550.00</span><span class="p">,</span> <span class="mf">1600.00</span><span class="p">,</span> <span class="mf">2.96220e-07</span><span class="p">,</span> <span class="mf">1.29250e-06</span><span class="p">,</span> <span class="mf">2.61812e-07</span><span class="p">,</span> <span class="mf">0.000814814</span><span class="p">,</span> <span class="mf">1.04567</span><span class="p">,</span> <span class="mf">0.967804</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1500.00</span><span class="p">,</span> <span class="mf">1550.00</span><span class="p">,</span> <span class="mf">2.35326e-07</span><span class="p">,</span> <span class="mf">1.21123e-06</span><span class="p">,</span> <span class="mf">2.27793e-07</span><span class="p">,</span> <span class="mf">0.000566574</span><span class="p">,</span> <span class="mf">1.13520</span><span class="p">,</span> <span class="mf">0.970257</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1450.00</span><span class="p">,</span> <span class="mf">1500.00</span><span class="p">,</span> <span class="mf">1.86793e-07</span><span class="p">,</span> <span class="mf">5.96399e-07</span><span class="p">,</span> <span class="mf">1.48283e-07</span><span class="p">,</span> <span class="mf">0.000331058</span><span class="p">,</span> <span class="mf">1.01564</span><span class="p">,</span> <span class="mf">0.940506</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1400.00</span><span class="p">,</span> <span class="mf">1450.00</span><span class="p">,</span> <span class="mf">1.96396e-07</span><span class="p">,</span> <span class="mf">5.84154e-07</span><span class="p">,</span> <span class="mf">1.82438e-07</span><span class="p">,</span> <span class="mf">0.000207013</span><span class="p">,</span> <span class="mf">1.67546</span><span class="p">,</span> <span class="mf">0.945697</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1350.00</span><span class="p">,</span> <span class="mf">1400.00</span><span class="p">,</span> <span class="mf">1.04362e-07</span><span class="p">,</span> <span class="mf">5.02422e-07</span><span class="p">,</span> <span class="mf">1.45100e-07</span><span class="p">,</span> <span class="mf">0.000153277</span><span class="p">,</span> <span class="mf">1.04246</span><span class="p">,</span> <span class="mf">0.992749</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1300.00</span><span class="p">,</span> <span class="mf">1350.00</span><span class="p">,</span> <span class="mf">1.74403e-07</span><span class="p">,</span> <span class="mf">6.32214e-07</span><span class="p">,</span> <span class="mf">4.03009e-07</span><span class="p">,</span> <span class="mf">0.000311075</span><span class="p">,</span> <span class="mf">1.00964</span><span class="p">,</span> <span class="mf">1.09381</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1250.00</span><span class="p">,</span> <span class="mf">1300.00</span><span class="p">,</span> <span class="mf">7.12738e-08</span><span class="p">,</span> <span class="mf">2.44220e-07</span><span class="p">,</span> <span class="mf">9.56532e-08</span><span class="p">,</span> <span class="mf">9.68823e-05</span><span class="p">,</span> <span class="mf">1.15737</span><span class="p">,</span> <span class="mf">1.01121</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1200.00</span><span class="p">,</span> <span class="mf">1250.00</span><span class="p">,</span> <span class="mf">8.74335e-06</span><span class="p">,</span> <span class="mf">5.02272e-05</span><span class="p">,</span> <span class="mf">1.32536e-05</span><span class="p">,</span> <span class="mf">0.00263307</span><span class="p">,</span> <span class="mf">1.46273</span><span class="p">,</span> <span class="mf">0.987493</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1215.67</span><span class="p">,</span> <span class="mf">1215.67</span><span class="p">,</span> <span class="mf">6.43713e-06</span><span class="p">,</span> <span class="mf">5.16823e-05</span><span class="p">,</span> <span class="mf">1.11399e-05</span><span class="p">,</span> <span class="mf">0.00247063</span><span class="p">,</span> <span class="mf">1.26340</span><span class="p">,</span> <span class="mf">0.998295</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1150.00</span><span class="p">,</span> <span class="mf">1200.00</span><span class="p">,</span> <span class="mf">1.15468e-07</span><span class="p">,</span> <span class="mf">2.74916e-07</span><span class="p">,</span> <span class="mf">1.65125e-07</span><span class="p">,</span> <span class="mf">0.000105178</span><span class="p">,</span> <span class="mf">1.66887</span><span class="p">,</span> <span class="mf">1.00997</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1100.00</span><span class="p">,</span> <span class="mf">1150.00</span><span class="p">,</span> <span class="mf">7.71861e-08</span><span class="p">,</span> <span class="mf">2.15061e-07</span><span class="p">,</span> <span class="mf">1.44227e-07</span><span class="p">,</span> <span class="mf">5.16157e-05</span><span class="p">,</span> <span class="mf">0.971988</span><span class="p">,</span> <span class="mf">1.05634</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1050.00</span><span class="p">,</span> <span class="mf">1100.00</span><span class="p">,</span> <span class="mf">5.84127e-08</span><span class="p">,</span> <span class="mf">3.08808e-07</span><span class="p">,</span> <span class="mf">1.25160e-07</span><span class="p">,</span> <span class="mf">4.65227e-05</span><span class="p">,</span> <span class="mf">1.58808</span><span class="p">,</span> <span class="mf">1.05327</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1000.00</span><span class="p">,</span> <span class="mf">1050.00</span><span class="p">,</span> <span class="mf">2.23073e-07</span><span class="p">,</span> <span class="mf">6.92710e-07</span><span class="p">,</span> <span class="mf">5.19444e-07</span><span class="p">,</span> <span class="mf">5.44992e-05</span><span class="p">,</span> <span class="mf">0.449052</span><span class="p">,</span> <span class="mf">1.10271</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1031.91</span><span class="p">,</span> <span class="mf">1031.91</span><span class="p">,</span> <span class="mf">6.18723e-08</span><span class="p">,</span> <span class="mf">1.21679e-07</span><span class="p">,</span> <span class="mf">2.28527e-07</span><span class="p">,</span> <span class="mf">3.14905e-05</span><span class="p">,</span> <span class="mf">1.42684</span><span class="p">,</span> <span class="mf">1.17863</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1025.72</span><span class="p">,</span> <span class="mf">1025.72</span><span class="p">,</span> <span class="mf">1.61504e-07</span><span class="p">,</span> <span class="mf">4.38856e-07</span><span class="p">,</span> <span class="mf">2.79663e-07</span><span class="p">,</span> <span class="mf">1.06365e-05</span><span class="p">,</span> <span class="mf">1.09262</span><span class="p">,</span> <span class="mf">1.05186</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">950.00</span><span class="p">,</span> <span class="mf">1000.00</span><span class="p">,</span> <span class="mf">1.70358e-07</span><span class="p">,</span> <span class="mf">5.20531e-07</span><span class="p">,</span> <span class="mf">3.86006e-07</span><span class="p">,</span> <span class="mf">3.34989e-05</span><span class="p">,</span> <span class="mf">0.491283</span><span class="p">,</span> <span class="mf">1.09676</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">977.02</span><span class="p">,</span> <span class="mf">977.02</span><span class="p">,</span> <span class="mf">1.51857e-07</span><span class="p">,</span> <span class="mf">5.60743e-07</span><span class="p">,</span> <span class="mf">2.74541e-07</span><span class="p">,</span> <span class="mf">6.71100e-06</span><span class="p">,</span> <span class="mf">1.44918</span><span class="p">,</span> <span class="mf">1.04869</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">900.00</span><span class="p">,</span> <span class="mf">950.00</span><span class="p">,</span> <span class="mf">7.27646e-08</span><span class="p">,</span> <span class="mf">4.53511e-07</span><span class="p">,</span> <span class="mf">1.91513e-07</span><span class="p">,</span> <span class="mf">3.93851e-05</span><span class="p">,</span> <span class="mf">1.21476</span><span class="p">,</span> <span class="mf">1.06473</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">850.00</span><span class="p">,</span> <span class="mf">900.00</span><span class="p">,</span> <span class="mf">1.45264e-07</span><span class="p">,</span> <span class="mf">2.82927e-07</span><span class="p">,</span> <span class="mf">4.22856e-07</span><span class="p">,</span> <span class="mf">4.83494e-05</span><span class="p">,</span> <span class="mf">1.15579</span><span class="p">,</span> <span class="mf">1.14948</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">800.00</span><span class="p">,</span> <span class="mf">850.00</span><span class="p">,</span> <span class="mf">6.69560e-08</span><span class="p">,</span> <span class="mf">1.26613e-07</span><span class="p">,</span> <span class="mf">1.76066e-07</span><span class="p">,</span> <span class="mf">3.69687e-05</span><span class="p">,</span> <span class="mf">1.14722</span><span class="p">,</span> <span class="mf">1.12832</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">750.00</span><span class="p">,</span> <span class="mf">800.00</span><span class="p">,</span> <span class="mf">3.22816e-08</span><span class="p">,</span> <span class="mf">7.81757e-08</span><span class="p">,</span> <span class="mf">6.32959e-08</span><span class="p">,</span> <span class="mf">4.42679e-05</span><span class="p">,</span> <span class="mf">0.969748</span><span class="p">,</span> <span class="mf">1.06692</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">789.36</span><span class="p">,</span> <span class="mf">789.36</span><span class="p">,</span> <span class="mf">1.19733e-08</span><span class="p">,</span> <span class="mf">2.53334e-08</span><span class="p">,</span> <span class="mf">1.58546e-08</span><span class="p">,</span> <span class="mf">1.25539e-05</span><span class="p">,</span> <span class="mf">1.48302</span><span class="p">,</span> <span class="mf">1.00982</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">770.41</span><span class="p">,</span> <span class="mf">770.41</span><span class="p">,</span> <span class="mf">7.33597e-09</span><span class="p">,</span> <span class="mf">2.10650e-08</span><span class="p">,</span> <span class="mf">1.63125e-08</span><span class="p">,</span> <span class="mf">8.88041e-06</span><span class="p">,</span> <span class="mf">1.18634</span><span class="p">,</span> <span class="mf">1.06584</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">765.15</span><span class="p">,</span> <span class="mf">765.15</span><span class="p">,</span> <span class="mf">4.85967e-09</span><span class="p">,</span> <span class="mf">1.05567e-08</span><span class="p">,</span> <span class="mf">5.42104e-09</span><span class="p">,</span> <span class="mf">1.15262e-05</span><span class="p">,</span> <span class="mf">1.17912</span><span class="p">,</span> <span class="mf">1.03352</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">700.00</span><span class="p">,</span> <span class="mf">750.00</span><span class="p">,</span> <span class="mf">1.85139e-08</span><span class="p">,</span> <span class="mf">3.63837e-08</span><span class="p">,</span> <span class="mf">3.29576e-08</span><span class="p">,</span> <span class="mf">1.72134e-05</span><span class="p">,</span> <span class="mf">1.25328</span><span class="p">,</span> <span class="mf">1.06364</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">703.36</span><span class="p">,</span> <span class="mf">703.36</span><span class="p">,</span> <span class="mf">5.34708e-09</span><span class="p">,</span> <span class="mf">9.65120e-09</span><span class="p">,</span> <span class="mf">4.54419e-09</span><span class="p">,</span> <span class="mf">8.80278e-06</span><span class="p">,</span> <span class="mf">1.51207</span><span class="p">,</span> <span class="mf">0.972520</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">650.00</span><span class="p">,</span> <span class="mf">700.00</span><span class="p">,</span> <span class="mf">1.79851e-08</span><span class="p">,</span> <span class="mf">6.39605e-08</span><span class="p">,</span> <span class="mf">1.86000e-08</span><span class="p">,</span> <span class="mf">1.41950e-05</span><span class="p">,</span> <span class="mf">1.11181</span><span class="p">,</span> <span class="mf">0.945801</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">600.00</span><span class="p">,</span> <span class="mf">650.00</span><span class="p">,</span> <span class="mf">1.52595e-07</span><span class="p">,</span> <span class="mf">5.29641e-07</span><span class="p">,</span> <span class="mf">1.41837e-07</span><span class="p">,</span> <span class="mf">3.96165e-05</span><span class="p">,</span> <span class="mf">1.00554</span><span class="p">,</span> <span class="mf">0.949913</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">629.73</span><span class="p">,</span> <span class="mf">629.73</span><span class="p">,</span> <span class="mf">4.96048e-08</span><span class="p">,</span> <span class="mf">2.46454e-07</span><span class="p">,</span> <span class="mf">3.12902e-08</span><span class="p">,</span> <span class="mf">1.59200e-05</span><span class="p">,</span> <span class="mf">1.01611</span><span class="p">,</span> <span class="mf">0.846628</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">609.76</span><span class="p">,</span> <span class="mf">609.76</span><span class="p">,</span> <span class="mf">2.80641e-08</span><span class="p">,</span> <span class="mf">3.24530e-07</span><span class="p">,</span> <span class="mf">1.81554e-08</span><span class="p">,</span> <span class="mf">1.68460e-06</span><span class="p">,</span> <span class="mf">0.973085</span><span class="p">,</span> <span class="mf">0.793355</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">550.00</span><span class="p">,</span> <span class="mf">600.00</span><span class="p">,</span> <span class="mf">1.12234e-07</span><span class="p">,</span> <span class="mf">6.29889e-07</span><span class="p">,</span> <span class="mf">1.56092e-07</span><span class="p">,</span> <span class="mf">2.79143e-05</span><span class="p">,</span> <span class="mf">0.961457</span><span class="p">,</span> <span class="mf">0.970150</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">584.33</span><span class="p">,</span> <span class="mf">584.33</span><span class="p">,</span> <span class="mf">7.91646e-08</span><span class="p">,</span> <span class="mf">3.05430e-07</span><span class="p">,</span> <span class="mf">5.14430e-08</span><span class="p">,</span> <span class="mf">1.70372e-05</span><span class="p">,</span> <span class="mf">0.844250</span><span class="p">,</span> <span class="mf">0.881026</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">554.31</span><span class="p">,</span> <span class="mf">554.31</span><span class="p">,</span> <span class="mf">2.47485e-08</span><span class="p">,</span> <span class="mf">2.68042e-07</span><span class="p">,</span> <span class="mf">5.40951e-08</span><span class="p">,</span> <span class="mf">1.16226e-06</span><span class="p">,</span> <span class="mf">1.08699</span><span class="p">,</span> <span class="mf">1.01483</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">500.00</span><span class="p">,</span> <span class="mf">550.00</span><span class="p">,</span> <span class="mf">1.12037e-07</span><span class="p">,</span> <span class="mf">7.84515e-07</span><span class="p">,</span> <span class="mf">6.32364e-08</span><span class="p">,</span> <span class="mf">4.55230e-06</span><span class="p">,</span> <span class="mf">1.13480</span><span class="p">,</span> <span class="mf">0.816868</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">450.00</span><span class="p">,</span> <span class="mf">500.00</span><span class="p">,</span> <span class="mf">1.10016e-07</span><span class="p">,</span> <span class="mf">3.96192e-07</span><span class="p">,</span> <span class="mf">7.37101e-08</span><span class="p">,</span> <span class="mf">2.62692e-05</span><span class="p">,</span> <span class="mf">1.15344</span><span class="p">,</span> <span class="mf">0.865234</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">465.22</span><span class="p">,</span> <span class="mf">465.22</span><span class="p">,</span> <span class="mf">9.60010e-09</span><span class="p">,</span> <span class="mf">1.75358e-08</span><span class="p">,</span> <span class="mf">6.91440e-11</span><span class="p">,</span> <span class="mf">1.45142e-05</span><span class="p">,</span> <span class="mf">1.62256</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.203971</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">400.00</span><span class="p">,</span> <span class="mf">450.00</span><span class="p">,</span> <span class="mf">5.15555e-08</span><span class="p">,</span> <span class="mf">2.89821e-07</span><span class="p">,</span> <span class="mf">3.85807e-08</span><span class="p">,</span> <span class="mf">1.64207e-05</span><span class="p">,</span> <span class="mf">1.36652</span><span class="p">,</span> <span class="mf">0.893190</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">350.00</span><span class="p">,</span> <span class="mf">400.00</span><span class="p">,</span> <span class="mf">3.91955e-07</span><span class="p">,</span> <span class="mf">1.43942e-06</span><span class="p">,</span> <span class="mf">3.16713e-07</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.36108e-06</span><span class="p">,</span> <span class="mf">1.05819</span><span class="p">,</span> <span class="mf">0.910235</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">368.07</span><span class="p">,</span> <span class="mf">368.07</span><span class="p">,</span> <span class="mf">1.38855e-07</span><span class="p">,</span> <span class="mf">7.21254e-07</span><span class="p">,</span> <span class="mf">1.01814e-07</span><span class="p">,</span> <span class="mf">8.71098e-07</span><span class="p">,</span> <span class="mf">1.26707</span><span class="p">,</span> <span class="mf">0.890513</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">300.00</span><span class="p">,</span> <span class="mf">350.00</span><span class="p">,</span> <span class="mf">1.35439e-06</span><span class="p">,</span> <span class="mf">1.09238e-05</span><span class="p">,</span> <span class="mf">8.24308e-07</span><span class="p">,</span> <span class="mf">4.35250e-05</span><span class="p">,</span> <span class="mf">1.22619</span><span class="p">,</span> <span class="mf">0.816515</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">303.78</span><span class="p">,</span> <span class="mf">303.78</span><span class="p">,</span> <span class="mf">7.43959e-07</span><span class="p">,</span> <span class="mf">5.94012e-06</span><span class="p">,</span> <span class="mf">4.05188e-07</span><span class="p">,</span> <span class="mf">9.23799e-05</span><span class="p">,</span> <span class="mf">1.32976</span><span class="p">,</span> <span class="mf">0.796970</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">303.31</span><span class="p">,</span> <span class="mf">303.31</span><span class="p">,</span> <span class="mf">5.25977e-07</span><span class="p">,</span> <span class="mf">7.87164e-06</span><span class="p">,</span> <span class="mf">3.07932e-07</span><span class="p">,</span> <span class="mf">7.87468e-05</span><span class="p">,</span> <span class="mf">0.945961</span><span class="p">,</span> <span class="mf">0.759694</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">250.00</span><span class="p">,</span> <span class="mf">300.00</span><span class="p">,</span> <span class="mf">9.10710e-07</span><span class="p">,</span> <span class="mf">3.91586e-06</span><span class="p">,</span> <span class="mf">1.20177e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.64301e-06</span><span class="p">,</span> <span class="mf">1.07360</span><span class="p">,</span> <span class="mf">0.958369</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">284.15</span><span class="p">,</span> <span class="mf">284.15</span><span class="p">,</span> <span class="mf">8.67633e-07</span><span class="p">,</span> <span class="mf">6.00671e-06</span><span class="p">,</span> <span class="mf">3.97664e-07</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000107230</span><span class="p">,</span> <span class="mf">1.20608</span><span class="p">,</span> <span class="mf">0.773950</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">256.30</span><span class="p">,</span> <span class="mf">256.30</span><span class="p">,</span> <span class="mf">6.44996e-08</span><span class="p">,</span> <span class="mf">4.12637e-07</span><span class="p">,</span> <span class="mf">1.05193e-07</span><span class="p">,</span> <span class="mf">6.61853e-06</span><span class="p">,</span> <span class="mf">1.48670</span><span class="p">,</span> <span class="mf">1.03265</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">200.00</span><span class="p">,</span> <span class="mf">250.00</span><span class="p">,</span> <span class="mf">4.83013e-07</span><span class="p">,</span> <span class="mf">1.18898e-06</span><span class="p">,</span> <span class="mf">8.94772e-07</span><span class="p">,</span> <span class="mf">5.34779e-05</span><span class="p">,</span> <span class="mf">1.04532</span><span class="p">,</span> <span class="mf">1.07888</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">150.00</span><span class="p">,</span> <span class="mf">200.00</span><span class="p">,</span> <span class="mf">7.13305e-07</span><span class="p">,</span> <span class="mf">2.47623e-06</span><span class="p">,</span> <span class="mf">9.78936e-07</span><span class="p">,</span> <span class="mf">0.000261230</span><span class="p">,</span> <span class="mf">1.47374</span><span class="p">,</span> <span class="mf">1.01156</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">100.00</span><span class="p">,</span> <span class="mf">150.00</span><span class="p">,</span> <span class="mf">4.03676e-08</span><span class="p">,</span> <span class="mf">2.28270e-07</span><span class="p">,</span> <span class="mf">4.43965e-08</span><span class="p">,</span> <span class="mf">2.16162e-05</span><span class="p">,</span> <span class="mf">1.09062</span><span class="p">,</span> <span class="mf">0.970310</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">50.00</span><span class="p">,</span> <span class="mf">100.00</span><span class="p">,</span> <span class="mf">1.69769e-07</span><span class="p">,</span> <span class="mf">6.93618e-07</span><span class="p">,</span> <span class="mf">2.89457e-07</span><span class="p">,</span> <span class="mf">2.03013e-05</span><span class="p">,</span> <span class="mf">1.07887</span><span class="p">,</span> <span class="mf">1.06022</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">32.00</span><span class="p">,</span> <span class="mf">50.00</span><span class="p">,</span> <span class="mf">1.23478e-07</span><span class="p">,</span> <span class="mf">4.43644e-07</span><span class="p">,</span> <span class="mf">1.75749e-07</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.34567e-05</span><span class="p">,</span> <span class="mf">1.27409</span><span class="p">,</span> <span class="mf">1.01254</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">23.00</span><span class="p">,</span> <span class="mf">32.00</span><span class="p">,</span> <span class="mf">6.10174e-08</span><span class="p">,</span> <span class="mf">2.34313e-07</span><span class="p">,</span> <span class="mf">1.10591e-07</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.22729e-05</span><span class="p">,</span> <span class="mf">0.699812</span><span class="p">,</span> <span class="mf">1.04841</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">16.00</span><span class="p">,</span> <span class="mf">23.00</span><span class="p">,</span> <span class="mf">2.23866e-07</span><span class="p">,</span> <span class="mf">7.97533e-07</span><span class="p">,</span> <span class="mf">3.03563e-07</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.62012e-05</span><span class="p">,</span> <span class="mf">0.706360</span><span class="p">,</span> <span class="mf">0.987835</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">8.00</span><span class="p">,</span> <span class="mf">16.00</span><span class="p">,</span> <span class="mf">3.10773e-07</span><span class="p">,</span> <span class="mf">1.22767e-06</span><span class="p">,</span> <span class="mf">3.74797e-07</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.41459e-05</span><span class="p">,</span> <span class="mf">1.39529</span><span class="p">,</span> <span class="mf">0.963859</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">4.00</span><span class="p">,</span> <span class="mf">8.00</span><span class="p">,</span> <span class="mf">1.17378e-08</span><span class="p">,</span> <span class="mf">7.13970e-08</span><span class="p">,</span> <span class="mf">1.38839e-08</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.63146e-06</span><span class="p">,</span> <span class="mf">0.811119</span><span class="p">,</span> <span class="mf">0.920702</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.00</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">3.97985e-09</span><span class="p">,</span> <span class="mf">4.12085e-08</span><span class="p">,</span> <span class="mf">4.71914e-09</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.86099e-06</span><span class="p">,</span> <span class="mf">1.15214</span><span class="p">,</span> <span class="mf">0.916686</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.00</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">,</span> <span class="mf">3.52498e-09</span><span class="p">,</span> <span class="mf">1.57342e-08</span><span class="p">,</span> <span class="mf">4.03741e-09</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.84488e-07</span><span class="p">,</span> <span class="mf">0.951714</span><span class="p">,</span> <span class="mf">0.943490</span><span class="p">]</span>
    <span class="p">])</span>
<span class="c1">#-----------------------------------------------------------------------------------------------------------------------</span>

<span class="c1">#-----------------------------------------------------------------------------------------------------------------------</span>
<span class="c1"># Functions:</span>

<span class="c1"># Functional form for the NEUVAC empirical model:</span>
<span class="c1"># Irr_i(t) = A_i * (F107(t)**B_i) + C_i * (F107A(t)**D_i) + E_i * (F107A(t) - F107(t)) + F_i</span>
<div class="viewcode-block" id="irrFunc">
<a class="viewcode-back" href="../../../EUVpy.NEUVAC.neuvac.html#EUVpy.NEUVAC.neuvac.irrFunc">[docs]</a>
<<<<<<< HEAD
<span class="k">def</span> <span class="nf">irrFunc</span><span class="p">(</span><span class="n">F107input</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parametric formula used to model solar irradiance a given wavelength band as a function of F10.7 and F10.7A.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    F107input : list</span>
<span class="sd">        Contains two elements. The first element is F10.7 data. The second element is F10.7A data (81-day averaged F10.7</span>
<span class="sd">        data, centered on the current day). The second element must be the same length as the first. For the operational</span>
<span class="sd">        version of NEUVAC, the second element should correspond to 54-day averaged F10.7 data in a backwards-looking</span>
<span class="sd">        window.</span>
<span class="sd">    A : float</span>
<span class="sd">        The first model coefficient.</span>
<span class="sd">    B : float</span>
<span class="sd">        The exponent of the first model term.</span>
<span class="sd">    C : float</span>
<span class="sd">        The second model coefficient.</span>
<span class="sd">    D : float</span>
<span class="sd">        The exponent of the second model term.</span>
<span class="sd">    E : float</span>
<span class="sd">        The third model coefficient.</span>
<span class="sd">    F : float</span>
<span class="sd">        The intercept term.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    irradiance : arraylike</span>
<span class="sd">        The solar irradiance in a given wavelength band, in units of either W/m^2/nm or W/m^2.</span>
<span class="sd">    &quot;&quot;&quot;</span>
=======
<span class="k">def</span><span class="w"> </span><span class="nf">irrFunc</span><span class="p">(</span><span class="n">F107input</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
    <span class="n">F107</span><span class="p">,</span> <span class="n">F107A</span> <span class="o">=</span> <span class="n">F107input</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">F107</span> <span class="o">**</span> <span class="n">B</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="p">(</span><span class="n">F107A</span> <span class="o">**</span> <span class="n">D</span><span class="p">)</span> <span class="o">+</span> <span class="n">E</span> <span class="o">*</span> <span class="p">(</span><span class="n">F107A</span> <span class="o">-</span> <span class="n">F107</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span></div>


<div class="viewcode-block" id="neuvacEUV">
<a class="viewcode-back" href="../../../EUVpy.NEUVAC.neuvac.html#EUVpy.NEUVAC.neuvac.neuvacEUV">[docs]</a>
<<<<<<< HEAD
<span class="k">def</span> <span class="nf">neuvacEUV</span><span class="p">(</span><span class="n">f107</span><span class="p">,</span> <span class="n">f107a</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tableFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">statsFiles</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use a parametric model to compute solar flux in the 59 conventional wavelength bands used by Aether/GITM. Capable</span>
<span class="sd">    of returning perturbed irradiance values that are perturbed according to the variations of in the intensity of each</span>
<span class="sd">    bin. Uses Eq. 4 from Brandt and Ridley, 2025 (doi:10.1029/2024SW004043).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f107 : numpy.ndarray</span>
<span class="sd">        F10.7 values.</span>
<span class="sd">    f107a : numpy.ndarray</span>
<span class="sd">        81-day center-averaged F10.7 values; must be the same length as f107.</span>
<span class="sd">    bands : str</span>
<span class="sd">        If None or &#39;NEUVAC&#39;, returns irradiances in the GITM Bands. If &#39;EUVAC&#39;, returns them in the 37 bands used by</span>
<span class="sd">        EUVAC. If &#39;SOLOMON&#39;, returns them in the 22 bands used by Solomon and Qian. Default is None.</span>
<span class="sd">    tableFile : str</span>
<span class="sd">        Corresponds to the .txt file holding the NEUVAC coefficients most recently-generated by fitNeuvac.py. If</span>
<span class="sd">        not given, simply uses the table file corresponding to the selected bin structure. Default is None.</span>
<span class="sd">    statsFiles : list</span>
<span class="sd">        A 2 element list where the first element is a file containing the 59x59 correlation matrix and the second</span>
<span class="sd">        element is a file containing the 1x59 standard deviation values for NEUVAC. Not required. Default is None.</span>
<span class="sd">    euvIrradiance: numpy.ndarray</span>
<span class="sd">        A nxm ndarray where n is the number of EUV irradiance values and m is the number of wavelength bands.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    perturbedEuvIrradiance : ndarray</span>
<span class="sd">        A nxm ndarray where n is the number of EUV irradiance values perturbed due to inherent uncertainty and m is the</span>
<span class="sd">        number of wavelength bands.</span>
<span class="sd">    savedPerts : ndarray</span>
<span class="sd">        A nxm ndarray of the perturbations (time series of the NEUVAC+Perturbation - NEUVAC)</span>
<span class="sd">    cc2 : numpy.ndarray</span>
=======
<span class="k">def</span><span class="w"> </span><span class="nf">neuvacEUV</span><span class="p">(</span><span class="n">f107</span><span class="p">,</span> <span class="n">f107a</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tableFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">statsFiles</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use a parametric model to compute solar flux in the 59 conventional wavelength bands used by Aether/GITM. Capable</span>
<span class="sd">    of returning perturbed irradiance values that are perturbed according to the variations of in the intensity of each</span>
<span class="sd">    bin</span>
<span class="sd">    :param f107: ndarray</span>
<span class="sd">        F10.7 values.</span>
<span class="sd">    :param f107a: ndarray</span>
<span class="sd">        81-day center-averaged F10.7 values; must be the same length as f107.</span>
<span class="sd">    :param bands: str</span>
<span class="sd">        If None or &#39;NEUVAC&#39;, returns irradiances in the GITM Bands. If &#39;EUVAC&#39;, returns them in the 37 bands used by</span>
<span class="sd">        EUVAC. If &#39;SOLOMON&#39;, returns them in the 22 bands used by Solomon and Qian.</span>
<span class="sd">    :param tableFile: str</span>
<span class="sd">        Corresponds to the .txt file holding the NEUVAC coefficients most recently-generated by fitNeuvac.py. If</span>
<span class="sd">        not given, simply uses the table file corresponding to the selected bin structure. Default is None.</span>
<span class="sd">    :param statsFiles: list</span>
<span class="sd">        A 2 element list where the first element is a file containing the 59x59 correlation matrix and the second</span>
<span class="sd">        element is a file containing the 1x59 standard deviation values for NEUVAC. NOT REQUIRED.</span>
<span class="sd">    :return euvIrradiance: ndarray</span>
<span class="sd">        A nxm ndarray where n is the number of EUV irradiance values and m is the number of wavelength bands.</span>
<span class="sd">    :return perturbedEuvIrradiance: ndarray</span>
<span class="sd">        A nxm ndarray where n is the number of EUV irradiance values perturbed due to inherent uncertainty and m is the</span>
<span class="sd">        number of wavelength bands.</span>
<span class="sd">    :return savedPerts: ndarray</span>
<span class="sd">        A nxm ndarray of the perturbations (time series of the NEUVAC+Perturbation - NEUVAC)</span>
<span class="sd">    :return cc2: ndarray</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
<span class="sd">        A mxm ndarray of the correlation matrix between each wavelength&#39;s time-series of the NEUVAC+Perturbation -</span>
<span class="sd">        NEUVAC.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">f107</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">f107</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">f107</span><span class="p">])</span>
        <span class="n">f107a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">f107a</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">bands</span> <span class="o">==</span> <span class="s1">&#39;SOLOMON&#39;</span><span class="p">:</span>
            <span class="n">solarFlux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solarFlux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">waveTable</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bands</span> <span class="o">==</span> <span class="s1">&#39;SOLOMON&#39;</span><span class="p">:</span>
            <span class="n">solarFlux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">f107</span><span class="p">),</span> <span class="mi">22</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solarFlux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">f107</span><span class="p">),</span> <span class="n">waveTable</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">euvIrradiance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">solarFlux</span><span class="p">)</span>
    <span class="n">perturbedEuvIrradiance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">solarFlux</span><span class="p">)</span>
    <span class="c1"># Gather the model parameters:</span>
    <span class="k">if</span> <span class="n">tableFile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bands</span> <span class="o">==</span> <span class="s1">&#39;SOLOMON&#39;</span><span class="p">:</span>
            <span class="n">tableFile</span> <span class="o">=</span> <span class="s1">&#39;data/neuvac_table_stan_bands.txt&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tableFile</span> <span class="o">=</span> <span class="s1">&#39;data/neuvac_table.txt&#39;</span>
    <span class="n">neuvacTable</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">here</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">tableFile</span><span class="p">))</span> <span class="k">as</span> <span class="n">neuvacFile</span><span class="p">:</span> <span class="c1"># open(tableFile)</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">neuvacFile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">17</span><span class="p">:</span>
                <span class="n">neuvacTable</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)])</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
    <span class="n">neuvacTable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">neuvacTable</span><span class="p">)</span>

    <span class="c1"># If no stats file is provided, simply return the base model output (using the required table file):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">statsFiles</span><span class="p">:</span>
        <span class="c1"># Loop across the F10.7 (and F10.7A) values:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f107</span><span class="p">)):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">solarFlux</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="n">irrRes</span> <span class="o">=</span> <span class="n">irrFunc</span><span class="p">([</span><span class="n">f107</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f107a</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="o">*</span><span class="n">neuvacTable</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">irrRes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">irrRes</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">euvIrradiance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">irrRes</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">euvIrradiance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">irrRes</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">bands</span> <span class="o">==</span> <span class="s1">&#39;EUVAC&#39;</span><span class="p">:</span>  <span class="c1"># Returns values ONLY for those corresponding to the wavelengths used by EUVAC</span>
            <span class="k">return</span> <span class="n">euvIrradiance</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">:</span><span class="mi">44</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">euvIrradiance</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Include statistical data for calculating uncertainties via perturbations:</span>
        <span class="n">corMatFile</span> <span class="o">=</span> <span class="n">statsFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#&#39;../../experiments/corMat.pkl&#39;</span>
        <span class="n">corMat</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">toolbox</span><span class="o">.</span><span class="n">loadPickle</span><span class="p">(</span><span class="n">corMatFile</span><span class="p">)</span>
        <span class="n">sigmaFile</span> <span class="o">=</span> <span class="n">statsFiles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#&#39;../../experiments/sigma_NEUVAC.pkl&#39;</span>
        <span class="n">STDNeuvacResids</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">toolbox</span><span class="o">.</span><span class="n">loadPickle</span><span class="p">(</span><span class="n">sigmaFile</span><span class="p">)</span>
        <span class="c1"># Loop across the F10.7 (and F10.7A) values:</span>
        <span class="n">nTimes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f107</span><span class="p">)</span>
        <span class="n">nWaves</span> <span class="o">=</span> <span class="n">solarFlux</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">savedPerts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nTimes</span><span class="p">,</span> <span class="n">nWaves</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f107</span><span class="p">)):</span>
            <span class="c1"># Loop across the wavelengths (59 conventional wavelengths):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">P_n</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">solarFlux</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="c1"># Percentage perturbation:</span>
                <span class="n">P_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">P_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">P_j</span><span class="p">)</span>
                <span class="n">P_1</span> <span class="o">=</span> <span class="n">P_n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Normalized Correlated Perturbation:</span>
                <span class="k">if</span> <span class="n">bands</span> <span class="o">==</span> <span class="s1">&#39;SOLOMON&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">C_j1</span> <span class="o">=</span> <span class="n">corMat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="c1"># 3 # Only consider correlation with the third wavelength bin of the SOLOMON bins!</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">C_j1</span> <span class="o">=</span> <span class="n">corMat</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="c1"># Only consider correlation with the fifth wavelength bin of the SOLOMON bins!</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
                        <span class="c1"># Only consider correlation with the third wavelength bin (of the NEUVAC bins!) when bands are below 8.</span>
                        <span class="n">C_j1</span> <span class="o">=</span> <span class="n">corMat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="c1"># 2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Only consider correlation with the first wavelength bin (of the EUVAC bins!) when bands are above 8.</span>
                        <span class="n">C_j1</span> <span class="o">=</span> <span class="n">corMat</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="n">N_j</span> <span class="o">=</span> <span class="n">C_j1</span> <span class="o">*</span> <span class="n">P_1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">C_j1</span><span class="p">)</span> <span class="o">*</span> <span class="n">P_j</span>
                <span class="c1"># Actual Normalized Correlated Perturbation:</span>
                <span class="n">A_j</span> <span class="o">=</span> <span class="n">STDNeuvacResids</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">N_j</span>
                <span class="n">irrRes</span> <span class="o">=</span> <span class="n">irrFunc</span><span class="p">([</span><span class="n">f107</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">f107a</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="o">*</span><span class="n">neuvacTable</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">irrRes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">irrRes</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">euvIrradiance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">irrRes</span>
                    <span class="k">if</span> <span class="n">irrRes</span> <span class="o">+</span> <span class="n">A_j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">perturbedEuvIrradiance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">perturbedEuvIrradiance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">irrRes</span> <span class="o">+</span> <span class="n">A_j</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">euvIrradiance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">irrRes</span>
                    <span class="n">perturbedEuvIrradiance</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">irrRes</span> <span class="o">+</span> <span class="n">A_j</span>
                <span class="n">savedPerts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A_j</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Generate a correlation matrix of the perturbations (to compare to the input correlation matrix as a sanity check):</span>
        <span class="n">cc2</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">toolbox</span><span class="o">.</span><span class="n">mycorrelate2d</span><span class="p">(</span><span class="n">savedPerts</span><span class="p">,</span> <span class="n">normalized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Visualize the original correlation matrix alongside the correlation matrix from the perturbations (sanity check):</span>
        <span class="c1"># cmap = cm.bwr</span>
        <span class="c1"># lims = [-1, 1]</span>
        <span class="c1"># fig = plt.figure(figsize=(10, 6))</span>
        <span class="c1"># ax1 = fig.add_axes([0.05, 0.1, 0.4, 0.7])</span>
        <span class="c1"># ax2 = fig.add_axes([0.5, 0.1, 0.4, 0.7])</span>
        <span class="c1"># pos1 = ax1.pcolor(corMat, vmin=lims[0], vmax=lims[-1], cmap=cmap)</span>
        <span class="c1"># fig.colorbar(pos1)</span>
        <span class="c1"># ax1.set_title(&#39;Original CC&#39;)</span>
        <span class="c1"># ax1.set_aspect(1)</span>
        <span class="c1"># pos2 = ax2.pcolor(cc2, vmin=lims[0], vmax=lims[-1], cmap=cmap)</span>
        <span class="c1"># fig.colorbar(pos2)</span>
        <span class="c1"># ax2.set_aspect(1)</span>
        <span class="c1"># ax2.set_title(&#39;Revised CC&#39;)</span>
        <span class="c1"># plt.tight_layout()</span>

        <span class="k">if</span> <span class="n">bands</span> <span class="o">==</span> <span class="s1">&#39;EUVAC&#39;</span><span class="p">:</span>  <span class="c1"># Returns values ONLY for those corresponding to the wavelengths used by EUVAC</span>
            <span class="k">return</span> <span class="n">euvIrradiance</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">:</span><span class="mi">44</span><span class="p">],</span> <span class="n">perturbedEuvIrradiance</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">:</span><span class="mi">44</span><span class="p">],</span> <span class="n">savedPerts</span><span class="p">,</span> <span class="n">cc2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">euvIrradiance</span><span class="p">,</span> <span class="n">perturbedEuvIrradiance</span><span class="p">,</span> <span class="n">savedPerts</span><span class="p">,</span> <span class="n">cc2</span></div>


<div class="viewcode-block" id="neuvacFit">
<a class="viewcode-back" href="../../../EUVpy.NEUVAC.neuvac.html#EUVpy.NEUVAC.neuvac.neuvacFit">[docs]</a>
<<<<<<< HEAD
<span class="k">def</span> <span class="nf">neuvacFit</span><span class="p">(</span><span class="n">f107Data</span><span class="p">,</span> <span class="n">irrTimes</span><span class="p">,</span> <span class="n">irrData</span><span class="p">,</span> <span class="n">wavelengths</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constrain</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
=======
<span class="k">def</span><span class="w"> </span><span class="nf">neuvacFit</span><span class="p">(</span><span class="n">f107Data</span><span class="p">,</span> <span class="n">irrTimes</span><span class="p">,</span> <span class="n">irrData</span><span class="p">,</span> <span class="n">wavelengths</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constrain</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate entirely new empirical parametric fits between F10.7 data and solar EUV irradiance data, irrespective</span>
<span class="sd">    of the number of wavelength bands the irradiance data is split into.</span>

<<<<<<< HEAD
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f107Data : list</span>
<span class="sd">        A list where the first element is an arraylike of datetimes for each F10.7 value, the second element is an</span>
<span class="sd">        arraylike of F10.7 values, and the third element is an arraylike of centered running 81-day averaged F10.7</span>
<span class="sd">        values.</span>
<span class="sd">    irrTimes : arraylike</span>
<span class="sd">        An arraylike of datetimes for each solar EUV spectra in irrData.</span>
<span class="sd">    irrData : numpy.ndarray</span>
<span class="sd">        An array of solar EUV irradiance measurements or estimates (from FISM, TIMED/SEE, etc.), arranged such that</span>
<span class="sd">        there is a single observation per row. A single observaton contains the entire EUV spectrum for a single day.</span>
<span class="sd">    wavelengths : arraylike</span>
<span class="sd">        An array of wavelengths to which the irradiance data corresponds.</span>
<span class="sd">    label : None</span>
<span class="sd">        An optional argument specifying the label for the data the model is being constructed for. Default is None.</span>
<span class="sd">    constraint : bool</span>
<span class="sd">        An optional argument that if True, constrains the fitted function to yield nonnegative outputs.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fitParams : numpy.ndarray</span>
<span class="sd">        An array of coefficients with which to compute the irradiance in each bin.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ENFORCING MODEL RESULTS TO BE NONZERO:</span>
    <span class="c1"># Objective (cost) function:</span>
    <span class="k">def</span> <span class="nf">objFun</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">variables</span><span class="p">):</span>
=======
<span class="sd">    :param list f107Data: A list where the first element is an arraylike of datetimes for each F10.7 value, the second element is an arraylike of F10.7 values, and the third element is an arraylike of centered running 81-day averaged F10.7 values.</span>
<span class="sd">    :param arraylike irrTimes: An arraylike of datetimes for each solar EUV spectra in irrData.</span>
<span class="sd">    :param ndarray irrData: An array of solar EUV irradiance measurements or estimates (from FISM, TIMED/SEE, etc.), arranged such that there is a single observation per row. A single observaton contains the entire EUV spectrum for a single day.</span>
<span class="sd">    :param arraylike wavelengths: An array of wavelengths to which the irradiance data corresponds.</span>
<span class="sd">    :param label: An optional argument specifying the label for the data the model is being constructed for. Default is None.</span>
<span class="sd">    :param bool constraint: An optional argument that if True, constrains the fitted function to yield nonnegative outputs.</span>
<span class="sd">    :param ndarray fitParams: An array of coefficients with which to compute the irradiance in each bin.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ENFORCING MODEL RESULTS TO BE NONZERO:</span>
    <span class="c1"># Objective (cost) function:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">objFun</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">variables</span><span class="p">):</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">variables</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">irrFunc</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Constraint (model output must be nonnegative):</span>
<<<<<<< HEAD
    <span class="k">def</span> <span class="nf">constraint</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">variables</span><span class="p">):</span>
=======
    <span class="k">def</span><span class="w"> </span><span class="nf">constraint</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">variables</span><span class="p">):</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
        <span class="k">return</span> <span class="n">irrFunc</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Isolate the valid times for performing the fit:</span>
    <span class="n">f107times</span> <span class="o">=</span> <span class="n">f107Data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f107</span> <span class="o">=</span> <span class="n">f107Data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">f107A</span> <span class="o">=</span> <span class="n">f107Data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">validInds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">f107times</span> <span class="o">&gt;=</span> <span class="n">irrTimes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f107times</span> <span class="o">&lt;=</span> <span class="n">irrTimes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f107TimesSubset</span> <span class="o">=</span> <span class="n">f107times</span><span class="p">[</span><span class="n">validInds</span><span class="p">]</span>
    <span class="n">f107Subset</span> <span class="o">=</span> <span class="n">f107</span><span class="p">[</span><span class="n">validInds</span><span class="p">]</span>
    <span class="n">f107ASubset</span> <span class="o">=</span> <span class="n">f107A</span><span class="p">[</span><span class="n">validInds</span><span class="p">]</span>

    <span class="c1"># Ensure we plot the correct subset by also subsetting the irradiances to the same times as above:</span>
    <span class="n">validIrrInds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">irrTimes</span> <span class="o">&gt;=</span> <span class="n">f107TimesSubset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">irrTimes</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">f107TimesSubset</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">))))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">irrTimesSubset</span> <span class="o">=</span> <span class="n">irrTimes</span><span class="p">[</span><span class="n">validIrrInds</span><span class="p">]</span>
    <span class="n">irrDataSubset</span> <span class="o">=</span> <span class="n">irrData</span><span class="p">[</span><span class="n">validIrrInds</span><span class="p">,</span> <span class="p">:]</span>

    <span class="c1"># Ensure that the time resolution is harmonized between the subset F10.7 data and the irradiance data, so that only</span>
    <span class="c1"># the elements co-located in time will be considered for fitting:</span>
    <span class="n">f107TimesSubsetNearest</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">f107SubsetNearest</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">f107ASubsetNearest</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">irrTimesSubset</span><span class="p">)):</span>
        <span class="n">coLocatedInfo</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">toolbox</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">f107TimesSubset</span><span class="p">,</span> <span class="n">irrTimesSubset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">f107TimesSubsetNearest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f107TimesSubset</span><span class="p">[</span><span class="n">coLocatedInfo</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">f107SubsetNearest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f107Subset</span><span class="p">[</span><span class="n">coLocatedInfo</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">f107ASubsetNearest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f107ASubset</span><span class="p">[</span><span class="n">coLocatedInfo</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">f107Predictors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f107SubsetNearest</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">f107ASubsetNearest</span><span class="p">)])</span>

    <span class="c1"># Loop through each individual band and perform the fit, returning the obtained coefficients:</span>
    <span class="n">fitParams</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">irrDataSubset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">nonNanLocs</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">irrDataSubset</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
        <span class="n">fitResult0</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">irrFunc</span><span class="p">,</span> <span class="n">f107Predictors</span><span class="p">[:,</span> <span class="n">nonNanLocs</span><span class="p">],</span> <span class="n">irrDataSubset</span><span class="p">[:,</span> <span class="n">j</span><span class="p">][</span><span class="n">nonNanLocs</span><span class="p">])</span> <span class="c1">#, **kwargs) #, bounds=bnds)</span>
        <span class="n">fitPopt</span> <span class="p">,</span> <span class="n">fitPcov</span> <span class="o">=</span> <span class="n">fitResult0</span>
        <span class="k">if</span> <span class="n">constrain</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">initial_guess</span> <span class="o">=</span> <span class="n">fitResult0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">cons</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint</span><span class="p">,</span> <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">f107Predictors</span><span class="p">[:,</span> <span class="n">nonNanLocs</span><span class="p">]}</span>
            <span class="n">fitResult</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objFun</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;COBYLA&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">f107Predictors</span><span class="p">[:,</span> <span class="n">nonNanLocs</span><span class="p">],</span> <span class="n">irrDataSubset</span><span class="p">[:,</span> <span class="n">j</span><span class="p">][</span><span class="n">nonNanLocs</span><span class="p">]],</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span> <span class="c1"># method=&#39;COBYLA&#39;</span>
            <span class="n">fitPopt</span> <span class="o">=</span> <span class="n">fitResult</span><span class="o">.</span><span class="n">x</span>
        <span class="c1"># Plotting</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="c1"># Irradiance vs. F10.7:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">f107Predictors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">irrDataSubset</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;F10.7 (sfu)&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Irradiance (W/m$^2$/nm)&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Irradiance vs. F10.7 (&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; Angstroms)&#39;</span><span class="p">)</span>
        <span class="c1"># Irradiance vs. F10.7A:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">f107Predictors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">irrDataSubset</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;F10.7A (sfu)&#39;</span><span class="p">)</span>
        <span class="c1"># axs[1].set_ylabel(&#39;Irradiance (W/m$^2$/nm)&#39;)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Irradiance vs. F10.7A (&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; Angstroms)&#39;</span><span class="p">)</span>
        <span class="c1"># Fit results:</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">irrFunc</span><span class="p">(</span><span class="n">f107Predictors</span><span class="p">,</span> <span class="o">*</span><span class="n">fitPopt</span><span class="p">)</span>
        <span class="c1"># Ensure positive-definiteness:</span>
        <span class="n">pred</span><span class="p">[</span><span class="n">pred</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f107TimesSubset</span><span class="p">,</span> <span class="n">irrDataSubset</span><span class="p">[:,</span> <span class="n">j</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f107TimesSubset</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NEUVAC&#39;</span><span class="p">)</span> <span class="c1">#/1e8, 1e5,</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="c1"># axs[2].set_ylabel(&#39;Irradiance (W/m$^2$/nm)&#39;)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Model Results&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="c1"># Ylims (always set to mean +/- 3 sigma):</span>
        <span class="c1"># meanIrr = np.nanmean(irrDataSubset[:, j])</span>
        <span class="c1"># if j+1 == 9 or j+1 == 10:</span>
        <span class="c1">#     axs[0].set_ylim([0, 5*meanIrr])</span>
        <span class="c1">#     axs[1].set_ylim([0, 5*meanIrr])</span>
        <span class="c1">#     axs[2].set_ylim([-meanIrr, 5*meanIrr])</span>
        <span class="c1"># elif j+1 == 13:</span>
        <span class="c1">#     axs[0].set_ylim([0, 2.2 * meanIrr])</span>
        <span class="c1">#     axs[1].set_ylim([0, 2.2 * meanIrr])</span>
        <span class="c1">#     axs[2].set_ylim([-meanIrr, 2.2 * meanIrr])</span>
        <span class="c1"># Appending:</span>
        <span class="n">fitParams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fitResult0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># Saving the figure:</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;FISM2&#39;</span><span class="p">:</span>
            <span class="n">fileLoc</span> <span class="o">=</span> <span class="s1">&#39;Base&#39;</span>
        <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;FISM2S&#39;</span><span class="p">:</span>
            <span class="n">fileLoc</span> <span class="o">=</span> <span class="s1">&#39;StanBands&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid value for argument &#39;label&#39;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Fitting/&#39;</span><span class="o">+</span><span class="n">fileLoc</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="s1">&#39;NEUVAC_&#39;</span> <span class="o">+</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_fit_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;_A.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Fitting/&#39;</span><span class="o">+</span><span class="n">fileLoc</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="s1">&#39;NEUVAC_fit_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;_A.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">fitParams</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">fitParams</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fitParams</span></div>


<div class="viewcode-block" id="gitmNEUVAC">
<a class="viewcode-back" href="../../../EUVpy.NEUVAC.neuvac.html#EUVpy.NEUVAC.neuvac.gitmNEUVAC">[docs]</a>
<<<<<<< HEAD
<span class="k">def</span> <span class="nf">gitmNEUVAC</span><span class="p">(</span><span class="n">f107times</span><span class="p">,</span> <span class="n">f107</span><span class="p">,</span> <span class="n">f107b</span><span class="p">):</span>
=======
<span class="k">def</span><span class="w"> </span><span class="nf">gitmNEUVAC</span><span class="p">(</span><span class="n">f107times</span><span class="p">,</span> <span class="n">f107</span><span class="p">,</span> <span class="n">f107b</span><span class="p">):</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write NEUVAC irradiances to a file for ingestion directly into the Global Ionosphere-Thermosphere Model. This code</span>
<span class="sd">    writes the data to 59 wavelength bins.</span>

<<<<<<< HEAD
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f107times : arraylike</span>
<span class="sd">        The timestamps for F10.7 values. Individual values must be datetimes.</span>
<span class="sd">    f107 : arraylike</span>
<span class="sd">        The F10.7 values. Individual values must be floats.</span>
<span class="sd">    f107b : arraylike</span>
<span class="sd">        The F10.7 values averaged in a 54-day backwards-looking window. Individual values must be floats.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    outfile : string</span>
<span class="sd">        The name of the output file.</span>
=======
<span class="sd">    :param arraylike f107times: The timestamps for F10.7 values. Individual values must be datetimes.</span>
<span class="sd">    :param arraylike f107: The F10.7 values. Individual values must be floats.</span>
<span class="sd">    :param arraylike f107b: The F10.7 values averaged in a 54-day backwards-looking window. Individual values must be floats.</span>
<span class="sd">    :return outfile: The name of the output file.</span>
<span class="sd">    :rtype: str</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing a GITM file with NEUVAC irradiances between &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f107times</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; and &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f107times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>

    <span class="n">neuvacIrr</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">neuvacEUV</span><span class="p">(</span><span class="n">f107</span><span class="p">,</span> <span class="n">f107b</span><span class="p">)</span>

<<<<<<< HEAD
    <span class="k">def</span> <span class="nf">numStr</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
=======
    <span class="k">def</span><span class="w"> </span><span class="nf">numStr</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>

<<<<<<< HEAD
    <span class="k">def</span> <span class="nf">safe_open_w</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
=======
    <span class="k">def</span><span class="w"> </span><span class="nf">safe_open_w</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
<span class="w">        </span><span class="sd">&#39;&#39;&#39; Open &quot;path&quot; for writing, creating any parent directories as needed.</span>
<span class="sd">        (https://stackoverflow.com/questions/23793987/write-a-file-to-a-directory-that-doesnt-exist)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="n">out_dir</span> <span class="o">=</span> <span class="s1">&#39;irradiances/&#39;</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">here</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">out_dir</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;/neuvac_euv_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f107times</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:</span><span class="mi">10</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_to_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f107times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])[:</span><span class="mi">10</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span>
    <span class="k">with</span> <span class="n">safe_open_w</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="c1"># Write the header information:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#START</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Write the irradiances themselves...</span>
        <span class="n">firstLine</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%.6g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">neuvacIrr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]]</span>
        <span class="n">firstLine_joined</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">firstLine</span><span class="p">)</span>
        <span class="c1"># The first line should always be a duplicate of the first line of data, but starting at UTC=00:00 of the first date:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f107times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">numStr</span><span class="p">(</span><span class="n">f107times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">numStr</span><span class="p">(</span><span class="n">f107times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;  0  0  0 &#39;</span><span class="o">+</span><span class="n">firstLine_joined</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># The rest of the lines can be straight from the data:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">neuvacIrr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">currentLine_joined</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%.6g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">neuvacIrr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]])</span>
            <span class="n">output</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f107times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">numStr</span><span class="p">(</span><span class="n">f107times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">numStr</span><span class="p">(</span><span class="n">f107times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">numStr</span><span class="p">(</span><span class="n">f107times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;  0  0 &#39;</span><span class="o">+</span><span class="n">currentLine_joined</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># The last line should occur 12 hours from the last datapoint, but have duplicate values there:</span>
        <span class="n">lastLine_joined</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%.6g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">neuvacIrr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]])</span>
        <span class="n">lastTime</span> <span class="o">=</span> <span class="n">f107times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lastTime</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">numStr</span><span class="p">(</span><span class="n">lastTime</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">numStr</span><span class="p">(</span><span class="n">lastTime</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;  0  0  0 &#39;</span><span class="o">+</span><span class="n">lastLine_joined</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote NEUVAC EUV irradiances to the following file: &#39;</span><span class="o">+</span><span class="n">outfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outfile</span></div>


<div class="viewcode-block" id="aetherFile">
<a class="viewcode-back" href="../../../EUVpy.NEUVAC.neuvac.html#EUVpy.NEUVAC.neuvac.aetherFile">[docs]</a>
<<<<<<< HEAD
<span class="k">def</span> <span class="nf">aetherFile</span><span class="p">(</span><span class="n">tableFile</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">here</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;data/neuvac_table.txt&#39;</span><span class="p">))):</span>
=======
<span class="k">def</span><span class="w"> </span><span class="nf">aetherFile</span><span class="p">(</span><span class="n">tableFile</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">here</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;data/neuvac_table.txt&#39;</span><span class="p">))):</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take the NEUVAC coefficients in the 59 wavelength bins and put them into a .csv file in a format for use by the</span>
<span class="sd">    Aether model.</span>

<<<<<<< HEAD
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tableFile : str</span>
<span class="sd">        The location of the NEUVAC table file to convert. Default is the 59-bin table file in the EUVpy repo. Default</span>
<span class="sd">        location is EUVpy/Src/EUVpy/data/.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    outfile : str</span>
<span class="sd">        The location of the .csv file for use by the Aether.</span>
<span class="sd">    &quot;&quot;&quot;</span>
=======
<span class="sd">    :param str tableFile: The location of the NEUVAC table file to convert. Default is the 59-bin table file in the EUVpy repo.</span>
<span class="sd">    :return outfile: The location of the .csv file for use by the Aether.</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>

>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
    <span class="c1"># Open the table file and read in the data:</span>
    <span class="n">neuvacTable</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tableFile</span><span class="p">)</span> <span class="k">as</span> <span class="n">neuvacFile</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">neuvacFile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">17</span><span class="p">:</span>
                <span class="n">neuvacTable</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)])</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">neuvacTable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">neuvacTable</span><span class="p">)</span>

    <span class="c1"># Open the Aether .csv file and rewrite the relevant rows with the correct coefficients:</span>
    <span class="n">aetherfilename_old</span> <span class="o">=</span> <span class="s1">&#39;../data/euv_59_reference.csv&#39;</span> <span class="c1"># &#39;../NEUVAC/irradiances/euv_59_reference.csv&#39;</span>
    <span class="n">aetherfilename</span> <span class="o">=</span> <span class="s1">&#39;../data/euv_59_aether.csv&#39;</span> <span class="c1"># &#39;../NEUVAC/irradiances/euv_59_aether.csv&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">here</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">aetherfilename_old</span><span class="p">))</span> <span class="k">as</span> <span class="n">inF</span><span class="p">:</span>
        <span class="n">fileLines</span> <span class="o">=</span> <span class="n">inF</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">inF</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
    <span class="n">lineOrder</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">here</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">aetherfilename</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outF</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">outF</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">line_number</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileLines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line_number</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]:</span>
                <span class="n">row_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">neuvacTable</span><span class="p">[:,</span> <span class="n">lineOrder</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                <span class="n">row_data_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">element</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">]</span>
                <span class="c1"># row_data_strings = []</span>
                <span class="c1"># for element in row_data:</span>
                <span class="c1">#     row_data_strings.append(str(element))</span>
                <span class="c1">#     row_data_strings.append(&#39;&#39;)</span>
                <span class="k">if</span> <span class="n">line_number</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">preceding_str</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; NEUV_S1&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;slope&#39;</span><span class="p">]</span> <span class="c1"># A_i</span>
                <span class="k">elif</span> <span class="n">line_number</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">preceding_str</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; NEUV_S2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">]</span> <span class="c1"># C_i</span>
                <span class="k">elif</span> <span class="n">line_number</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">preceding_str</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; NEUV_S3&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">]</span> <span class="c1"># E_i</span>
                <span class="k">elif</span> <span class="n">line_number</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">preceding_str</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; NEUV_l1&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;ints&#39;</span><span class="p">]</span> <span class="c1"># F_i</span>
                <span class="k">elif</span> <span class="n">line_number</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                    <span class="n">preceding_str</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; NEUV_P1&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;powers&#39;</span><span class="p">]</span> <span class="c1"># B_i</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">preceding_str</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; NEUV_P2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;powers&#39;</span><span class="p">]</span> <span class="c1"># D_i</span>
                <span class="n">row_to_write</span> <span class="o">=</span> <span class="n">preceding_str</span> <span class="o">+</span> <span class="n">row_data_strings</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;from GITM&#39;</span><span class="p">]</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row_to_write</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
            <span class="n">line_number</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">outfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">here</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">aetherfilename</span><span class="p">[</span><span class="mi">3</span><span class="p">:]))</span> <span class="c1"># aetherfilename</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wrote NEUVAC coefficients in Aether format to: &#39;</span> <span class="o">+</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">outfile</span></div>

<span class="c1">#-----------------------------------------------------------------------------------------------------------------------</span>
<<<<<<< HEAD
=======

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">aetherFile</span><span class="p">()</span>
>>>>>>> d1fd4f506d9c709e8a5788af361b8ce69dc9c163
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Michigan Tech Research Institute.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>